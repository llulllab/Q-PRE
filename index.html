<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Q-PRE Portal</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:760px;margin:40px auto;padding:0 16px;line-height:1.5}
    header h1{margin:0 0 8px 0}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px}
    button{padding:10px 14px;border-radius:10px;border:1px solid #333;background:#111;color:#fff;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .muted{color:#666;font-size:.9rem}
  </style>
</head>
<body>
  <header>
    <h1>Q-PRE — Journal Portal </h1>
    Q Reports – Peer-Reviewed Edition: Journal of Combinatorial Practices
    <p class="muted">Sign in with Google, then you'll be routed to your panel (Author / Reviewer / Editor).</p>
  </header>

  <div class="card">
    <p id="status">Not signed in.</p>
    <button id="googleSignIn">Sign in with Google</button>
    <button id="signOut" style="display:none;background:#666;border-color:#666">Sign out</button>
  </div>

  <p class="muted">After sign-in, you will be redirected depending on your role.</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    
/* Paste your Firebase web config here */
const firebaseConfig = {
  apiKey: "AIzaSyAaxb_8mpkTLVdCZeAGmTMMvr8ppIzc0Y0",
  authDomain: "q-pre-2c2d2.firebaseapp.com",
  projectId: "q-pre-2c2d2",
  storageBucket: "q-pre-2c2d2.firebasestorage.app",
  messagingSenderId: "553970542224",
  appId: "1:553970542224:web:a915f9f613a3816be9da15"
};


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const signInBtn = document.getElementById("googleSignIn");
    const signOutBtn = document.getElementById("signOut");
    const status = document.getElementById("status");

    function goto(rel) { window.location.href = rel; }

    async function routeByRole(email) {
      const ref = doc(db, "rolesByEmail", email);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        status.textContent = "Signed in as " + email + " — but no role is assigned yet. Please contact the editor.";
        return;
      }
      const role = snap.data().role;
      if (role === "author") goto("./upload-author.html");
      else if (role === "reviewer") goto("./upload-reviewer.html");
      else if (role === "editor") goto("./editor.html");
      else status.textContent = "Unknown role: " + role;
    }

    signInBtn.onclick = async () => {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    };

    signOutBtn.onclick = async () => {
      await signOut(auth);
    };

    onAuthStateChanged(auth, (u) => {
      if (u) {
        status.textContent = "Signed in: " + (u.email || u.uid);
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
        routeByRole(u.email);
      } else {
        status.textContent = "Not signed in.";
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
      }
    });
  </script>
</body>
</html>
